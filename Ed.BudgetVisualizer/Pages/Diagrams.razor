@page "/diagrams"

@inject LocalStorage Storage
@inject IJSRuntime JsRuntime

<h1>Diagrams</h1>

<div id="diagram-container">
    <p>No transactions loaded, cannot generate diagrams.</p>
</div>

@code {
    private string key = "transactions";
    private List<Transaction> Transactions;

    /// <summary>
    /// Handles the component initialization event.
    /// </summary>
    protected override async Task OnInitializedAsync()
    {
        // Load stored transactions
        Transactions = await Storage.GetItem<List<Transaction>>(key);

        // If there aren't any, initialize the storage
        if (Transactions == null)
        {
            await Storage.SetItem<List<Transaction>>(key, new List<Transaction>());
            Transactions = await Storage.GetItem<List<Transaction>>(key);
        }

        if (Transactions.Any())
        {
            await JsRuntime.InvokeAsync<bool>("RenderDiagram", Transactions.ToDiagramModel());
        }
    }
}
